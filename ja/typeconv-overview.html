<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>概要</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version "><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.1.4文書"
HREF="index.html"><LINK
REL="UP"
TITLE="型変換"
HREF="typeconv.html"><LINK
REL="PREVIOUS"
TITLE="型変換"
HREF="typeconv.html"><LINK
REL="NEXT"
TITLE="演算子"
HREF="typeconv-oper.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=euc-jp"><META
NAME="creation"
CONTENT="2012-06-16T03:12:10"></HEAD
><BODY
CLASS="SECT1"
><script type="text/javascript">
var mod_layout = 'test';
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-50659-6");
pageTracker._trackPageview();
</script>
<style>
body{margin:0;}
#lay_body{margin:8px;}
#lay_header{margin:0 0 4px 0;border:0;padding:0;}
#lay_header .b1{border-bottom:#cef solid 1px;}
#lay_header .b2{border-bottom:#8df solid 1px;}
#lay_header .b3{border-bottom:#4bf solid 1px;padding:5px 5px 3px 5px;background:#0af;text-align:center;color:#fff;}
#lay_header a{text-decoration:none;color:#fff;font-weight:bold;}
#lay_header a:hover{text-decoration:underline;}
</style>
<div id="lay_header"><div class="b1"><div class="b2"><div class="b3">
<a href="http://lets.postgresql.jp/" target="_blank">PostgreSQLポータルサイト ＜Let's Postgres＞ http://lets.postgresql.jp/</a><br>
入門から運用、チューニングノウハウ、新機能の解説など、幅広い内容の技術解説記事をお読みいただけます。
</div></div></div></div>
<div id="lay_body">
<DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="5"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.1.4文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="型変換"
HREF="typeconv.html"
ACCESSKEY="P"
>&#21069;&#12398;&#12506;&#12540;&#12472;</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="型変換"
HREF="typeconv.html"
>&#24059;&#25147;&#12375;</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
>&#31532; 10&#31456;型変換</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
TITLE="型変換"
HREF="typeconv.html"
>&#26089;&#36865;&#12426;</A
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
TITLE="演算子"
HREF="typeconv-oper.html"
ACCESSKEY="N"
>&#27425;&#12398;&#12506;&#12540;&#12472;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="TYPECONV-OVERVIEW"
>10.1. 概要</A
></H1
><P
><ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>は強く型付けされた言語です。
つまり、各データ項目は、その動作と許される使用方法を決定するデータ型を所有しています。
<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>には、他の<ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>の実装よりもより一般的で柔軟性のある、拡張可能な型システムがあります。
このために、<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>でのほとんどの型変換の動作は、特定の目的について<I
CLASS="FOREIGNPHRASE"
>勝手に作り上げられる</I
>ことなく一般的な規則で管理されています。
これにより、ユーザ定義型についても型の混在する式を使用できます。</P
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>のスキャナ/パーサは字句要素を、整数、非整数値、文字列、識別子、キーワードという5個の基礎カテゴリに分解します。
ほとんどの非数値型定数は、まず文字列にクラス分けされます。
<ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>言語定義では、文字列で型の名前を指定することを許していて、パーサが正しい手順に沿って処理を始められるように<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>も採用しています。
例えば、以下のような問い合わせを考えてみましょう。

</P><PRE
CLASS="SCREEN"
>SELECT text 'Origin' AS "label", point '(0,0)' AS "value";

 label  | value
--------+-------
 Origin | (0,0)
(1 row)</PRE
><P>

この問い合わせは、<TT
CLASS="TYPE"
>text</TT
>と<TT
CLASS="TYPE"
>point</TT
>という2つの型を指定したリテラル定数を持ちます。
文字列リテラルに型が指定されていない場合、後述するように、後の段階で解決されるようにとりあえず場所を確保するための型である<TT
CLASS="TYPE"
>unknown</TT
>が割り当てられます。</P
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>のパーサには、個別の型変換規則が必要な4つの基礎的な<ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>構成要素があります。

<P
></P
></P><DIV
CLASS="VARIABLELIST"
><DL
><DT
>関数呼び出し</DT
><DD
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>型システムの大部分は、高度な関数群によって構築されています。
関数は複数の引数を取ることができます。
<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>では関数のオーバーロードが可能ですので、関数名だけでは呼び出すべき関数を一意に識別できません。
パーサは、提供される引数のデータ型に基づいて、正しい関数を選択しなければなりません。</P
></DD
><DT
>演算子</DT
><DD
><P
><SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>では、（引数が2つの）二項演算子と同様に、（引数が1つの）前置、後置単項演算子を持つ式が使用できます。
関数と同様、演算子もオーバーロード可能ですので、正しい演算子を選択する時に同じ問題が存在します。&#13;</P
></DD
><DT
>値の格納</DT
><DD
><P
><ACRONYM
CLASS="ACRONYM"
>SQL</ACRONYM
>の<TT
CLASS="COMMAND"
>INSERT</TT
>と<TT
CLASS="COMMAND"
>UPDATE</TT
>文は式の結果をテーブルの中に格納します。
文内の式は対象となる列の型に一致する、または、変換できるものである必要があります。</P
></DD
><DT
><TT
CLASS="LITERAL"
>UNION</TT
>、<TT
CLASS="LITERAL"
>CASE</TT
>、および関連する構文</DT
><DD
><P
>UNIONを構成する<TT
CLASS="COMMAND"
>SELECT</TT
>文からの選択結果は全て、ある1つの列集合として現れなければいけませんので、各<TT
CLASS="LITERAL"
>SELECT</TT
>句の結果型は統一された集合に一致し変換できる必要があります。
同様に、<TT
CLASS="COMMAND"
>CASE</TT
>構文が全体として既知の出力型を持つようになるために、<TT
CLASS="LITERAL"
>CASE</TT
>構文の結果式は共通の型に変換される必要があります。
これは<TT
CLASS="LITERAL"
>ARRAY</TT
>構文でも<CODE
CLASS="FUNCTION"
>GREATEST</CODE
>関数、<CODE
CLASS="FUNCTION"
>LEAST</CODE
>関数でも同じです。</P
></DD
></DL
></DIV
><P></P
><P
>システムカタログには、データ型間の変換(もしくは<I
CLASS="FIRSTTERM"
>キャスト</I
>)が有効かどうかや、その変換の実行方法に関する情報を格納します。
ユーザは<A
HREF="sql-createcast.html"
>CREATE CAST</A
>コマンドを使用してキャストを追加することができます
（これは通常新しいデータ型を定義する時にまとめて行われます。
組み込み型間のキャスト集合は注意深く作成されており、また、変更しないことが最善です）。</P
><P
>暗黙のキャストを持つデータ型間の処理において、パーサが適切なキャスト処理のより良い決定を行えるよう追加の自律機構を備えています。データ型は、<TT
CLASS="TYPE"
>boolean</TT
>、<TT
CLASS="TYPE"
>numeric</TT
>、<TT
CLASS="TYPE"
>string</TT
>、<TT
CLASS="TYPE"
>bitstring</TT
>、<TT
CLASS="TYPE"
>datetime</TT
>、<TT
CLASS="TYPE"
>timespan</TT
>、<TT
CLASS="TYPE"
>geometric</TT
>、<TT
CLASS="TYPE"
>network</TT
>、及びユーザ定義を含むいくつかの<I
CLASS="FIRSTTERM"
>型カテゴリ</I
>に分けられます。
(<A
HREF="catalog-pg-type.html#CATALOG-TYPCATEGORY-TABLE"
>&#34920;45-49</A
>の一覧を参照してください。  独自の型カテゴリを作成可能なことに注意して下さい。)
各カテゴリは、候補となる型の選択があった場合に、好ましいとされる1つ以上の<I
CLASS="FIRSTTERM"
>好ましい型</I
>を持ちます。好ましい型の選択と利用可能な暗黙のキャストに注意すれば、曖昧な式（複数の解析結果侯補を持つもの)が有効な方法で解決されることを保証することが可能です。</P
><P
>全ての型変換規則は次のようないくつかの基本的な考え方に基づいて設計されています。

<P
></P
></P><UL
><LI
><P
>暗黙的な変換は、意外な、あるいは予想できない結果を決して生成させてはなりません。</P
></LI
><LI
><P
>暗黙的な型変換を必要としない問い合わせの場合、パーサやエクゼキュータに余計なオーバーヘッドがあるべきではありません。
つまり、問い合わせ文がきちんとまとめられ、型が既に一致するものになっていれば、パーサ内で余計な時間を費やさず、また、問い合わせに不要な暗黙的な型変換関数が使用されないように、問い合わせは処理されるべきです。</P
><P
>さらに、もし問い合わせが通常ならば関数を使った暗黙的な変換を要求していたものであり、そして、ユーザが正しい引数型を持つ関数を明示的に定義した場合、パーサはこの新しい関数を使い、古い関数を使用した暗黙的な変換を行わないようにしなければなりません。</P
></LI
></UL
><P></P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="typeconv.html"
ACCESSKEY="P"
>&#21069;&#12398;&#12506;&#12540;&#12472;</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>&#12507;&#12540;&#12512;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="typeconv-oper.html"
ACCESSKEY="N"
>&#27425;&#12398;&#12506;&#12540;&#12472;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>型変換</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="typeconv.html"
ACCESSKEY="U"
>&#19978;&#12395;&#25147;&#12427;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>演算子</TD
></TR
></TABLE
></DIV
></BODY
></HTML
></div>
