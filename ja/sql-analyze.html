<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>ANALYZE</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version "><LINK
REV="MADE"
HREF="mailto:pgsql-docs@postgresql.org"><LINK
REL="HOME"
TITLE="PostgreSQL 9.1.4文書"
HREF="index.html"><LINK
REL="UP"
TITLE="SQLコマンド"
HREF="sql-commands.html"><LINK
REL="PREVIOUS"
TITLE="ALTER VIEW"
HREF="sql-alterview.html"><LINK
REL="NEXT"
TITLE="BEGIN"
HREF="sql-begin.html"><LINK
REL="STYLESHEET"
TYPE="text/css"
HREF="stylesheet.css"><META
HTTP-EQUIV="Content-Type"
CONTENT="text/html; charset=euc-jp"><META
NAME="creation"
CONTENT="2012-06-16T03:12:10"></HEAD
><BODY
CLASS="REFENTRY"
><script type="text/javascript">
var mod_layout = 'test';
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-50659-6");
pageTracker._trackPageview();
</script>
<style>
body{margin:0;}
#lay_body{margin:8px;}
#lay_header{margin:0 0 4px 0;border:0;padding:0;}
#lay_header .b1{border-bottom:#cef solid 1px;}
#lay_header .b2{border-bottom:#8df solid 1px;}
#lay_header .b3{border-bottom:#4bf solid 1px;padding:5px 5px 3px 5px;background:#0af;text-align:center;color:#fff;}
#lay_header a{text-decoration:none;color:#fff;font-weight:bold;}
#lay_header a:hover{text-decoration:underline;}
</style>
<div id="lay_header"><div class="b1"><div class="b2"><div class="b3">
<a href="http://lets.postgresql.jp/" target="_blank">PostgreSQLポータルサイト ＜Let's Postgres＞ http://lets.postgresql.jp/</a><br>
入門から運用、チューニングノウハウ、新機能の解説など、幅広い内容の技術解説記事をお読みいただけます。
</div></div></div></div>
<div id="lay_body">
<DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="5"
ALIGN="center"
VALIGN="bottom"
><A
HREF="index.html"
>PostgreSQL 9.1.4文書</A
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="ALTER VIEW"
HREF="sql-alterview.html"
ACCESSKEY="P"
>&#21069;&#12398;&#12506;&#12540;&#12472;</A
></TD
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="top"
><A
TITLE="ALTER VIEW"
HREF="sql-alterview.html"
>&#24059;&#25147;&#12375;</A
></TD
><TD
WIDTH="60%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
TITLE="BEGIN"
HREF="sql-begin.html"
>&#26089;&#36865;&#12426;</A
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="top"
><A
TITLE="BEGIN"
HREF="sql-begin.html"
ACCESSKEY="N"
>&#27425;&#12398;&#12506;&#12540;&#12472;</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="SQL-ANALYZE"
></A
>ANALYZE</H1
><DIV
CLASS="REFNAMEDIV"
><A
NAME="AEN63130"
></A
><H2
>&#21517;&#21069;</H2
>ANALYZE&nbsp;--&nbsp;データベースに関する統計を集計する</DIV
><DIV
CLASS="REFSYNOPSISDIV"
><A
NAME="AEN63135"
></A
><H2
>&#27010;&#35201;</H2
><PRE
CLASS="SYNOPSIS"
>ANALYZE [ VERBOSE ] [ <TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
> [ ( <TT
CLASS="REPLACEABLE"
><I
>column</I
></TT
> [, ...] ) ] ]</PRE
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN63139"
></A
><H2
>説明</H2
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>はデータベース内のテーブルの内容に関する統計情報を集計し、その結果を<A
HREF="catalog-pg-statistic.html"
><TT
CLASS="STRUCTNAME"
>pg_statistic</TT
></A
>システムテーブルに保存します。
問い合わせプランナが最も効率の良い問い合わせの実行計画を決定する際、この統計情報が使用されます。
  </P
><P
>パラメータがない場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は現在のデータベース内の全てのテーブルを検査します。
パラメータがある場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は指定されたテーブルのみを検査します。
さらに列名のリストを与え、その列の統計情報のみを更新することも可能です。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN63148"
></A
><H2
>パラメータ</H2
><P
></P
><DIV
CLASS="VARIABLELIST"
><DL
><DT
><TT
CLASS="LITERAL"
>VERBOSE</TT
></DT
><DD
><P
>進行状況の表示を有効にします。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>table</I
></TT
></DT
><DD
><P
>解析の対象とするテーブルの名前です（スキーマ修飾名も可）。
デフォルトは、現在のデータベース内の全テーブルです。
     </P
></DD
><DT
><TT
CLASS="REPLACEABLE"
><I
>column</I
></TT
></DT
><DD
><P
>解析の対象とする列名です。
デフォルトは全ての列です。
     </P
></DD
></DL
></DIV
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN63166"
></A
><H2
>出力</H2
><P
><TT
CLASS="LITERAL"
>VERBOSE</TT
>が指定された場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は進捗メッセージとして処理中のテーブルを表示します。
さらに、テーブルについての各種統計情報も表示されます。
   </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN63171"
></A
><H2
>注釈</H2
><P
>デフォルトの<SPAN
CLASS="PRODUCTNAME"
>PostgreSQL</SPAN
>の設定では、自動バキュームデーモン（<A
HREF="routine-vacuuming.html#AUTOVACUUM"
>&#38917;23.1.5</A
>参照）が、データが最初にロードされた時や通常の操作を通して変更された時にテーブルの自動解析まで面倒をみます。
もし自動バキュームが無効にしているならば<TT
CLASS="COMMAND"
>ANALYZE</TT
>は定期的に、もしくは、テーブルの内容に大きな変更がある度に行うことを推奨します。
統計情報が正確であれば、プランナが最も適切な問い合わせ計画を選択できるようになります。 
これによって、問い合わせ処理の速度が向上します。
<A
HREF="sql-vacuum.html"
>VACUUM</A
>と<TT
CLASS="COMMAND"
>ANALYZE</TT
>は、1日1回、データベースがあまり使用されていない時間帯に実行するのが一般的です。
  </P
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>は、対象とするテーブルの読み取りロックのみを必要とします。
したがって、そのテーブルに対する他の操作と並行して実行することができます。
  </P
><P
>通常、<TT
CLASS="COMMAND"
>ANALYZE</TT
>によって集計される統計情報には、各列の典型的な値と各列のデータ分布の概要を示す度数分布が含まれます。
<TT
CLASS="COMMAND"
>ANALYZE</TT
>によってあまり意味がないとみなされた場合（例えば、一意性制約が付加された列では、典型的な値というものは存在しません）や、列のデータ型が適切な演算子をサポートしていない場合は、片方もしくは両方の情報を省略することができます。
<A
HREF="maintenance.html"
>&#31532;23&#31456;</A
>に、統計情報についての詳細が記載されています。
  </P
><P
>巨大なテーブルでは、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は、全ての行を検査するのではなく、テーブルの中からランダムにサンプルを取り出して使用します。
これによって、非常に巨大なテーブルであっても短時間で解析することが可能です。
しかし、このようにして得られた統計情報はおおよそのものでしかなく、テーブルの内容に変更がなくても<TT
CLASS="COMMAND"
>ANALYZE</TT
>を実行する度に変化することに注意してください。
これにより、<A
HREF="sql-explain.html"
>EXPLAIN</A
>が表示する、プランナの推定コストも多少変化する可能性があります。
稀に、このような不確定要素のせいで、プランナが<TT
CLASS="COMMAND"
>ANALYZE</TT
>を実行した後に異なる問い合わせ計画を選択してしまうことがあります。
これを防止するには、以下に示すように<TT
CLASS="COMMAND"
>ANALYZE</TT
>で収集される統計情報の量を増やしてください。
  </P
><P
><A
HREF="runtime-config-query.html#GUC-DEFAULT-STATISTICS-TARGET"
>default_statistics_target</A
>設定パラメータ変数を調整するか、もしくは<TT
CLASS="COMMAND"
>ALTER TABLE ... ALTER COLUMN ... SET STATISTICS</TT
>を使用して統計対象を列単位に設定し、解析を列ベースにすることで、解析の範囲を制御することができます
（詳しくは<A
HREF="sql-altertable.html"
>ALTER TABLE</A
>を参照してください）。
対象値として設定するのは、典型的な値のリストにおけるエントリ数の最大値と度数分布のビンの最大数です。
デフォルトの対象値は100です。 
しかし、この値は、プランナの推定精度と<TT
CLASS="COMMAND"
>ANALYZE</TT
>の処理時間、<TT
CLASS="LITERAL"
>pg_statistic</TT
>の占める容量とのトレードオフによって変更可能です。
対象値を0に設定すると、その列に関する統計情報の集計は無効になります。
決して<TT
CLASS="LITERAL"
>WHERE</TT
>句、<TT
CLASS="LITERAL"
>GROUP BY</TT
>句、<TT
CLASS="LITERAL"
>ORDER BY</TT
>句に使用されない列に対しては、このような設定が有用です。
プランナにとってそのような列の統計情報は不要だからです。
  </P
><P
>解析する列の統計情報対象値の最大値によって、統計情報を作成するために抽出する行数が決定します。
対象値を大きくすると、比例して、<TT
CLASS="COMMAND"
>ANALYZE</TT
>に要する時間とディスク容量が増加します。
  </P
><P
><TT
CLASS="COMMAND"
>ANALYZE</TT
>で推定される値の1つは各列に出現する個別値の個数です。
行の部分集合のみしか検査されませんので、統計情報の対象をできる限り大きくしたとしても、この推定値はかなり不正確になることが時々あり得ます。
この不正確性が問い合わせ計画を劣化させるような場合、より正確な値を手作業で求めることができ、そして、<TT
CLASS="COMMAND"
>ALTER TABLE ... ALTER COLUMN ... SET (n_distinct = ...)</TT
>でインストールすることができます（<A
HREF="sql-altertable.html"
>ALTER TABLE</A
>参照）。
  </P
><P
>解析中のテーブルが複数の子テーブルを持つ場合、<TT
CLASS="COMMAND"
>ANALYZE</TT
>は2回統計情報を収集します。
1回目は親テーブルのみのテーブル行を対象とし、2回目では親テーブルの行とそのすべての子テーブルの行を対象とします。
しかし自動バキュームデーモンでは、自動的に解析を行うかどうかを決定する際に親テーブル上の挿入や更新のみを考慮します。
このテーブルへの挿入や更新がほとんどなければ、継承関係に対する統計情報は手作業で<TT
CLASS="COMMAND"
>ANALYZE</TT
>を実行しない限り最新状態にはなりません。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN63209"
></A
><H2
>互換性</H2
><P
>標準SQLには<TT
CLASS="COMMAND"
>ANALYZE</TT
>文はありません。
  </P
></DIV
><DIV
CLASS="REFSECT1"
><A
NAME="AEN63213"
></A
><H2
>関連項目</H2
><A
HREF="sql-vacuum.html"
>VACUUM</A
>, <A
HREF="app-vacuumdb.html"
><SPAN
CLASS="APPLICATION"
>vacuumdb</SPAN
></A
>, <A
HREF="runtime-config-resource.html#RUNTIME-CONFIG-RESOURCE-VACUUM-COST"
>&#38917;18.4.3</A
>, <A
HREF="routine-vacuuming.html#AUTOVACUUM"
>&#38917;23.1.5</A
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="sql-alterview.html"
ACCESSKEY="P"
>&#21069;&#12398;&#12506;&#12540;&#12472;</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>&#12507;&#12540;&#12512;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="sql-begin.html"
ACCESSKEY="N"
>&#27425;&#12398;&#12506;&#12540;&#12472;</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>ALTER VIEW</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="sql-commands.html"
ACCESSKEY="U"
>&#19978;&#12395;&#25147;&#12427;</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>BEGIN</TD
></TR
></TABLE
></DIV
></BODY
></HTML
></div>
